---
header-includes: 
    \usepackage{titling}
    \pretitle{
      \begin{center}
      \includegraphics[width=\textwidth]{`r system.file("reports/presto.jpg", package="prestor")`}
      \end{center}
    }
    \posttitle{}
output:
    pdf_document:
        toc: true
    html_document:
        toc: true
params:
    title: "pRESTO Report: AbSeq v3"
    sample: "Sample"
    run: "Run"
    author: "Author"
    version: "Version"
    description: "Description"
    date: "Date"
    data: "../../test/logs"
    console: "Pipeline.log"
    quality_r1: "QualityLogR1_table.tab"
    quality_r2: "QualityLogR2_table.tab"
    primers_r1: "PrimerLogR1_table.tab"
    primers_r2: "PrimerLogR2_table.tab"
    consensus_r1: "ConsensusLogR1_table.tab"
    consensus_r2: "ConsensusLogR2_table.tab"
    assemble_align: "AssembleAlignLog_table.tab"
    assemble_reference: "AssembleReferenceLog_table.tab"
    primers_cregion: "CRegionLog_table.tab"
    headers_total: "Final_headers.tab"
    headers_unique: "Final-Unique_headers.tab"
    headers_atleast2: "Final-Unique-Atleast2_headers.tab"
title: "`r params$title`"
---

```{r, message=FALSE, echo=FALSE, results="hide"}
# Setup
library(prestor)
library(knitr)
library(captioner)
tables <- captioner(prefix="Table")
figures <- captioner(prefix="Figure")
# Check files
console_eval <- file.exists(file.path(params$data, params$console))
quality_eval <- all(file.exists(file.path(params$data, params$quality_r1)),
                    file.exists(file.path(params$data, params$quality_r2)))
primers_eval <- all(file.exists(file.path(params$data, params$primers_r1)),
                    file.exists(file.path(params$data, params$primers_r2)))
consensus_eval <- all(file.exists(file.path(params$data, params$consensus_r1)),
                      file.exists(file.path(params$data, params$consensus_r2)))
assemble_eval <- any(file.exists(file.path(params$data, params$assemble_align)),
                      file.exists(file.path(params$data, params$assemble_reference)))
cregion_eval <- file.exists(file.path(params$data, params$primers_cregion))
headers_eval <- all(file.exists(file.path(params$data, params$headers_total)),
                    file.exists(file.path(params$data, params$headers_unique)),
                    file.exists(file.path(params$data, params$headers_atleast2)))

```

```{r, child=system.file("reports/Front.Rmd", package="prestor"), eval=TRUE}
```

```{r, child=system.file("reports/Paired-Console.Rmd", package="prestor"), eval=console_eval}
```

```{r, child=system.file("reports/Paired-Quality.Rmd", package="prestor"), eval=quality_eval}
```

```{r, child=system.file("reports/Paired-Primers.Rmd", package="prestor"), eval=primers_eval}
```

```{r, child=system.file("reports/Paired-Consensus.Rmd", package="prestor"), eval=consensus_eval}
```

```{r, child=system.file("reports/Assembly.Rmd", package="prestor"), eval=assemble_eval}
```

```{r, child=system.file("reports/CRegion.Rmd", package="prestor"), eval=cregion_eval}
```

```{r child=system.file("reports/Headers.Rmd", package="prestor"), eval=headers_eval}
```
