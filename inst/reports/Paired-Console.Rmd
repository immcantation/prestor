---
output:
  pdf_document: default
  html_document: default
params:
  data: "."
  console: "Pipeline.log"
---

```{r, message=FALSE, echo=FALSE, results="hide"}
# Setup
library(prestor)
library(knitr)
library(captioner)
if (!exists("tables")) { tables <- captioner(prefix="Table") }
if (!exists("figures")) { figures <- captioner(prefix="Figure") }
tables("count", "The count of reads that passed and failed each processing step.")
figures("steps", "Reads retained at each processing step as raw count (top) and 
                  percentages of input from the previous step (bottom).")
```

```{r, echo=FALSE}
console_log <- loadConsoleLog(file.path(params$data, params$console))
```

# Summary of Processing Steps

The numbers (a) and the percentages (b) of the reads at the end of each step of the 
pRESTO pipeline (relative to the previous step). Within in each group, the columns 
represents Read 1 and Read 2, respectively.

```{r, echo=FALSE}
count_df <- plotConsoleLog(console_log, sizing="figure")
```

`r figures("steps")`

```{r, echo=FALSE}
kable(count_df[c("step", "task", "total", "pass", "fail")],
      col.names=c("Step", "Task", "Input", "Passed", "Failed"),
      digits=3)
```

`r tables("count")`