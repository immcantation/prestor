---
output:
  pdf_document: default
  html_document: default
params:
    data: "."
    primers_r1: "PrimerLogR1_table.tab"
    primers_r2: "PrimerLogR2_table.tab"
---

```{r, message=FALSE, echo=FALSE, results="hide"}
# Setup
library(prestor)
library(knitr)
library(captioner)
if (!exists("tables")) { tables <- captioner(prefix="Table") }
if (!exists("figures")) { figures <- captioner(prefix="Figure") }
figures("primers_count", "Count of identified primers for 
                          read 1 (top) and read 2 (bottom).")
figures("primers_hist", "Distribution of primer match error rates for 
                         read 1 (top) and read 2 (bottom).")
figures("primers_error", "Distribution of primer match error rates for 
                          read 1 (top) and read 2 (bottom), broken down 
                          by assigned primer.")
```

```{r, echo=FALSE}
primer_log_1 <- loadLogTable(file.path(params$data, params$primers_r1))
primer_log_2 <- loadLogTable(file.path(params$data, params$primers_r2))
```

# Primer Identification

The MaskPrimers tool supports identification of multiplexed barcodes and primers.
Once identified, these sub-sequences can be retained, masked (with Ns), or trimmed
from the reads. Individual barcodes and primers may also be associated with 
metadata (e.g. sample name, receptor isotype and/or UMIs) that can be used to 
automatically annotate each read.

## Count of primer matches

```{r, echo=FALSE}
plotMaskPrimers(primer_log_1, primer_log_2, titles=c("Read 1", "Read 2"),
              style="count", sizing="figure")
```

`r figures("primers_count")`

## Primer match error rates

```{r, echo=FALSE}
plotMaskPrimers(primer_log_1, primer_log_2, titles=c("Read 1", "Read 2"), 
                style="hist", sizing="figure")
```

`r figures("primers_hist")`

```{r, echo=FALSE}
plotMaskPrimers(primer_log_1, primer_log_2, titles=c("Read 1", "Read 2"), 
                style="error", sizing="figure")
```

`r figures("primers_error")`
